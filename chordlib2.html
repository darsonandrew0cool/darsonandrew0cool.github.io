<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shared Chord Charts</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --accent: #38bdf8;
      --text: #e5e7eb;
      --muted: #9ca3af;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      padding: 1rem 1.5rem;
      background: var(--panel);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav button {
      background: none;
      border: none;
      color: var(--text);
      margin-left: 1rem;
      cursor: pointer;
    }

    nav button.active { color: var(--accent); }

    main {
      padding: 1.5rem;
      max-width: 1000px;
      margin: auto;
    }

    section { display: none; }
    section.active { display: block; }

    .artist { margin-bottom: 1.5rem; }
    .artist h3 { border-bottom: 1px solid #1e293b; }

    .chart, .set-item {
      background: var(--panel);
      padding: 1rem;
      border-radius: 10px;
      margin-top: 0.75rem;
    }

    textarea, input, select {
      width: 100%;
      background: #020617;
      color: var(--text);
      border: 1px solid #1e293b;
      padding: 0.6rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      font-family: monospace;
    }

    button.primary {
      background: var(--accent);
      color: #020617;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    button.danger {
      background: #ef4444;
      border: none;
      color: white;
      padding: 0.4rem 0.7rem;
      border-radius: 6px;
      cursor: pointer;
      margin-left: 0.5rem;
    }

    .meta { color: var(--muted); font-size: 0.85rem; }
    pre { white-space: pre-wrap; }
  </style>
</head>
<body>

<header>
  <h2>Shared Chord Charts</h2>
  <nav>
    <button class="active" onclick="showSection('charts')">Charts</button>
    <button onclick="showSection('upload')">New Chart</button>
    <button onclick="showSection('setlist')">Sunday Setlist</button>
    <button onclick="showSection('settings')">Settings</button>
  </nav>
</header>

<main>

<section id="charts" class="active"></section>

<section id="upload">
  <h3>New Chord Chart</h3>
  <input id="title" placeholder="Song title" />
  <input id="artist" placeholder="Artist" />
  <input id="key" placeholder="Original Key" />
  <input id="tempo" placeholder="Tempo (BPM)" />
  <textarea id="sections" rows="3" placeholder="Sections (Verse, Chorus, Bridge)"></textarea>
  <textarea id="content" rows="10" placeholder="Chord chart..."></textarea>
  <button class="primary" onclick="saveChart()">Save Chart</button>
</section>

<section id="setlist">
  <h3>Sunday Setlist</h3>
  <input id="setSong" placeholder="Song title" />
  <input id="setKey" placeholder="Key" />
  <input id="setMusician" placeholder="Assigned musician" />
  <button class="primary" onclick="addSetItem()">Add to Setlist</button>
  <div id="setItems"></div>
</section>

<section id="settings">
  <h3>User Settings</h3>
  <input id="username" placeholder="Your name" />
  <button class="primary" onclick="saveUser()">Save Name</button>
  <p class="meta">All users on this device can see and add charts.</p>
</section>

</main>

<script>
const chartKey = 'shared_charts';
const setKey = 'sunday_setlist';
const userKey = 'current_user';

function currentUser() {
  return localStorage.getItem(userKey) || 'Anonymous';
}

function saveUser() {
  localStorage.setItem(userKey, document.getElementById('username').value || 'Anonymous');
}

function loadCharts() {
  return JSON.parse(localStorage.getItem(chartKey) || '[]');
}

function saveCharts(c) {
  localStorage.setItem(chartKey, JSON.stringify(c));
}

function renderCharts() {
  const el = document.getElementById('charts');
  el.innerHTML = '<h3>Chord Charts</h3>';

  const charts = loadCharts();
  const artists = [...new Set(charts.map(c => c.artist))];

  artists.forEach(a => {
    const div = document.createElement('div');
    div.className = 'artist';
    div.innerHTML = `<h3>${a}</h3>`;

    charts.filter(c => c.artist === a).forEach((c, i) => {
      const d = document.createElement('div');
      d.className = 'chart';
      d.innerHTML = `
        <strong>${c.title}</strong>
        <div class="meta">Key: ${c.key} | Tempo: ${c.tempo} | Added by: ${c.user}</div>
        <div class="meta">Sections: ${c.sections}</div>
        <pre>${c.content}</pre>
      `;
      div.appendChild(d);
    });

    el.appendChild(div);
  });
}

function saveChart() {
  const charts = loadCharts();
  charts.push({
    title: title.value,
    artist: artist.value,
    key: key.value,
    tempo: tempo.value,
    sections: sections.value,
    content: content.value,
    user: currentUser()
  });
  saveCharts(charts);
  showSection('charts');
  renderCharts();
}

function loadSetlist() {
  return JSON.parse(localStorage.getItem(setKey) || '[]');
}

function saveSetlist(s) {
  localStorage.setItem(setKey, JSON.stringify(s));
}

function addSetItem() {
  const list = loadSetlist();
  list.push({ song: setSong.value, key: setKey.value, musician: setMusician.value });
  saveSetlist(list);
  renderSetlist();
}

function renderSetlist() {
  const el = document.getElementById('setItems');
  el.innerHTML = '';
  loadSetlist().forEach(i => {
    const d = document.createElement('div');
    d.className = 'set-item';
    d.innerHTML = `<strong>${i.song}</strong><div class="meta">Key: ${i.key} | ${i.musician}</div>`;
    el.appendChild(d);
  });
}

function showSection(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

renderCharts();
renderSetlist();
</script>

</body>
</html>
